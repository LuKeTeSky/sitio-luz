<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LUZ - Administración</title>
    <link rel="stylesheet" href="/css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="admin-page">
    <!-- Header de administración -->
    <header class="header admin-header">
        <nav class="nav">
            <div class="nav-brand">
                <a href="/" class="brand-link">
                    <h1>LUZ</h1>
                    <span class="brand-subtitle">Administración</span>
                </a>
            </div>
            <div class="nav-menu">
                <a href="#cover-photos" class="nav-link">Portada</a>
                <a href="#gallery" class="nav-link" id="gallery-nav-btn">Galería</a>
                <a href="#upload" class="nav-link">Subir Fotos</a>
                <a href="#metrics" class="nav-link">Métricas</a>
                <a href="/logout" class="nav-link logout-link">
                    <i class="fas fa-sign-out-alt"></i>
                    Cerrar Sesión
                </a>
            </div>
        </nav>
    </header>

    <!-- Menú lateral de álbumes -->
    <aside class="albums-sidebar" id="albums-sidebar">
        <div class="sidebar-header">
            <h3><i class="fas fa-book-open"></i> Álbumes</h3>
            <button class="sidebar-toggle" id="sidebar-toggle">
                <i class="fas fa-chevron-left"></i>
            </button>
        </div>
        
        <div class="albums-container">
            <div class="albums-list" id="albums-list">
                <!-- Los álbumes se cargarán dinámicamente aquí -->
            </div>
            
            <div class="album-actions">
                <button class="btn-create-album" id="btn-create-album">
                    <i class="fas fa-plus"></i>
                    Nuevo Álbum
                </button>
            </div>
        </div>
    </aside>

    <!-- Overlay para cerrar sidebar en móvil -->
    <div class="sidebar-overlay" id="sidebar-overlay"></div>

    <!-- Modal para crear/editar álbum -->
    <div class="modal" id="album-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">Nuevo Álbum</h3>
                <button class="modal-close" id="modal-close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="album-form">
                    <div class="form-group">
                        <label for="album-name">Nombre del Álbum</label>
                        <input type="text" id="album-name" name="name" required>
                    </div>
                    <div class="form-group">
                        <label for="album-description">Descripción</label>
                        <textarea id="album-description" name="description" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="album-campaign">Campaña</label>
                        <input type="text" id="album-campaign" name="campaign" placeholder="Ej: Primavera 2024">
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn-secondary" id="btn-cancel">Cancelar</button>
                        <button type="submit" class="btn-primary">Guardar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Contenido principal -->
    <main class="main-content" id="main-content">
        <!-- Cover Section (Portada grande) -->
        <section id="cover-photos" class="cover-section">
            <div class="container">
                <div class="section-header">
                    <h2>Fotos de Portada</h2>
                    <p>Las mejores fotos seleccionadas para destacar</p>
                </div>
                <div class="cover-grid" id="cover-grid">
                    <!-- Las fotos de portada se cargarán dinámicamente aquí -->
                </div>
                <div class="cover-empty" id="cover-empty" style="display: block;">
                    <i class="fas fa-star"></i>
                    <h3>No hay fotos de portada</h3>
                    <p>Selecciona tus fotos favoritas marcándolas como portada en la galería</p>
                </div>
            </div>
        </section>

        <!-- Gallery Section -->
        <section id="gallery" class="gallery-section">
            <div class="container">
                <div class="section-header">
                    <h2>Galería de Fotos</h2>
                    <p>Una colección de momentos capturados con estilo y elegancia</p>
                    <div class="drag-drop-info">
                        <i class="fas fa-grip-vertical"></i>
                        <span>Arrastra las fotos para reordenarlas</span>
                    </div>
                </div>
                <div class="gallery-grid" id="gallery-grid">
                    <!-- Las imágenes se cargarán dinámicamente aquí -->
                </div>
            </div>
        </section>

        <!-- Upload Section -->
        <section id="upload" class="upload-section">
            <div class="container">
                <div class="upload-card">
                    <h3><i class="fas fa-cloud-upload-alt"></i> Subir Fotos</h3>
                    
                    <!-- Información de límites -->
                    <div class="upload-info">
                        <div class="upload-limits">
                            <span><i class="fas fa-file-image"></i> Formatos: JPG, PNG, GIF, WebP</span>
                            <span><i class="fas fa-weight-hanging"></i> Máximo: 5MB por imagen</span>
                            <span><i class="fas fa-layer-group"></i> Hasta 10 imágenes simultáneas</span>
                        </div>
                    </div>
                    
                    <form class="upload-form" enctype="multipart/form-data">
                        <div class="file-input-wrapper">
                            <input type="file" id="photo" name="photo" class="file-input" accept="image/jpeg,image/jpg,image/png,image/gif,image/webp" multiple required>
                            <label for="photo" class="file-label">
                                <i class="fas fa-images"></i>
                                <span>Seleccionar imágenes</span>
                            </label>
                            <div class="file-validation-info"></div>
                        </div>
                        <button type="submit" class="btn-upload">
                            <i class="fas fa-upload"></i>
                            Subir Fotos
                        </button>
                    </form>
                </div>
            </div>
        </section>

        <!-- Metrics Section -->
        <section id="metrics" class="metrics-section">
            <div class="container">
                <div class="section-header">
                    <h2>Métricas</h2>
                    <p>Visitas y eventos (últimos 7 días)</p>
                </div>
                <div id="metrics-content">
                    <div class="cards" id="metric-cards" style="display:flex;gap:16px;flex-wrap:wrap"></div>
                    <div class="chart-wrap" style="margin-top:16px">
                        <canvas id="visitsChart" height="120"></canvas>
                    </div>
                    <div id="metrics-breakdown" style="margin-top:12px;font-size:13px;color:#444"></div>
                </div>
            </div>
        </section>

        <!-- About Section -->
        <section id="about" class="about-section">
            <div class="container">
                <div class="about-content">
                    <div class="about-text">
                        <h2>Sobre Luz</h2>
                        <p>Modelo profesional con pasión por la fotografía de moda. Cada sesión es una oportunidad para contar una historia única a través de la lente.</p>
                        <div class="about-stats">
                            <div class="stat">
                                <span class="stat-number">50+</span>
                                <span class="stat-label">Sesiones</span>
                            </div>
                            <div class="stat">
                                <span class="stat-number">100+</span>
                                <span class="stat-label">Fotos</span>
                            </div>
                            <div class="stat">
                                <span class="stat-number">3+</span>
                                <span class="stat-label">Años</span>
                            </div>
                        </div>
                    </div>
                    <div class="about-image">
                        <div class="image-placeholder">
                            <i class="fas fa-user"></i>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Contact Section -->
        <section id="contact" class="contact-section">
            <div class="container">
                <div class="section-header">
                    <h2>Contacto</h2>
                    <p>¿Interesado en trabajar juntos? ¡Hablemos!</p>
                </div>
                <div class="contact-content">
                    <div class="contact-info">
                        <div class="contact-item">
                            <i class="fab fa-instagram"></i>
                            <a href="https://instagram.com/maria_luzcm" target="_blank" class="contact-link">@maria_luzcm</a>
                        </div>
                        <div class="contact-item">
                            <i class="fab fa-whatsapp"></i>
                            <a href="https://wa.me/5491153257400" target="_blank" class="contact-link">+54 9 11 5325-7400</a>
                        </div>
                        <div class="contact-item">
                            <i class="fas fa-envelope"></i>
                            <span>msmvdg@gmail.com</span>
                        </div>
                        <div class="contact-item">
                            <i class="fas fa-map-marker-alt"></i>
                            <span>Buenos Aires, Argentina</span>
                        </div>
                    </div>
                    <div class="social-links">
                        <a href="#" class="social-link"><i class="fab fa-instagram"></i></a>
                        <a href="#" class="social-link"><i class="fab fa-facebook"></i></a>
                        <a href="#" class="social-link"><i class="fab fa-twitter"></i></a>
                    </div>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="footer">
            <div class="container">
                <div class="footer-content">
                    <p>&copy; 2024 Luz - Portfolio de Moda. Todos los derechos reservados.</p>
                                    <div class="footer-version">
                    <span class="version-badge">v1.11.0</span>
                    <span class="build-info">build: 2025-08-10</span>
                </div>
                </div>
            </div>
        </footer>
    </main>

    <script src="/js/gallery.js"></script>
    <script src="/js/albums.js"></script>
    <script>
    (function(){
      function drawLineChart(canvas, labels, values){
        const ctx=canvas.getContext('2d');
        const W=canvas.width=canvas.clientWidth; const H=canvas.height=160;
        const pad=30; const innerW=W-pad*2; const innerH=H-pad*2;
        const max=Math.max(1, ...values);
        const min=0;
        // fondo
        ctx.clearRect(0,0,W,H);
        ctx.fillStyle='#fff'; ctx.fillRect(0,0,W,H);
        // ejes
        ctx.strokeStyle='#eee'; ctx.lineWidth=1;
        for(let i=0;i<=4;i++){ const y=pad + (innerH*i/4); ctx.beginPath(); ctx.moveTo(pad,y); ctx.lineTo(W-pad,y); ctx.stroke(); }
        // línea
        ctx.strokeStyle='#d4af37'; ctx.lineWidth=2; ctx.beginPath();
        values.forEach((v,idx)=>{
          const x=pad + innerW*(idx/(Math.max(values.length-1,1)));
          const y=pad + innerH*(1 - (v-min)/(max-min));
          if(idx===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
        });
        ctx.stroke();
        // relleno suave
        ctx.fillStyle='rgba(212,175,55,0.12)'; ctx.lineTo(W-pad, H-pad); ctx.lineTo(pad, H-pad); ctx.closePath(); ctx.fill();
      }
      async function loadMetrics(){
        try{
          try{ await fetch('/api/metrics/event',{method:'POST',headers:{'content-type':'application/json'},body:JSON.stringify({type:'page_view'})}); }catch(_){ }
          const res=await fetch('/api/metrics/summary?days=7',{headers:{'accept':'application/json'}});
          if(!res.ok) throw new Error('HTTP '+res.status);
          const data=await res.json();
          const cards=document.getElementById('metric-cards');
          cards.innerHTML='';
          const totalVisits=(data.visits||[]).reduce((a,b)=>a+b,0);
          const eventsTotals=(data.eventsTotals||{});
          const totalEvents=Object.values(eventsTotals).reduce((a,b)=>a+b,0);
          const card= (title, value)=>{
            const el=document.createElement('div');
            el.style.padding='12px';el.style.border='1px solid #eee';el.style.borderRadius='8px';
            el.innerHTML='<div style="font-size:12px;color:#666">'+title+'</div><div style="font-size:22px;font-weight:600">'+value+'</div>';
            return el;
          };
          cards.appendChild(card('Visitas (7 días)', totalVisits));
          cards.appendChild(card('Eventos (7 días)', totalEvents));
          // tarjetas específicas
          const uploads = eventsTotals['upload']||0;
          const apiErrors = eventsTotals['api_error']||0;
          cards.appendChild(card('Uploads (7 días)', uploads));
          cards.appendChild(card('Errores API (7 días)', apiErrors));
          drawLineChart(document.getElementById('visitsChart'), data.labels||[], data.visits||[]);
          // breakdown
          const breakdown=document.getElementById('metrics-breakdown');
          const entries=Object.entries(eventsTotals).sort((a,b)=>b[1]-a[1]);
          if(entries.length){
            breakdown.innerHTML = 'Desglose (7 días): ' + entries.map(([k,v])=>`${k}: ${v}`).join(' · ');
          } else { breakdown.innerHTML=''; }
        }catch(e){console.warn('loadMetrics error',e);}
      }
      const metricsSection=document.getElementById('metrics');
      const obs=new IntersectionObserver((entries)=>{entries.forEach(e=>{if(e.isIntersecting){loadMetrics();}})},{threshold:0.2});
      if(metricsSection) obs.observe(metricsSection);
    })();
    </script>
</body>
</html> 